<!DOCTYPE html>
<html>

<head>
    <title>Auto Scratch Desktop Mirror</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
    <link rel="shortcut icon" href="//www.google.com/s2/favicons?sz=64&domain=scratch.mit.edu">
   
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://registry.npmmirror.com/@mdi/font/6.9.96/files/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://registry.npmmirror.com/vuetify/2.7.1/files/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
</head>

<body>
    <div id="app">
        <v-app>
            <v-main>
                <v-toolbar elevation="4">
                    <v-app-bar-nav-icon>
                        <v-icon>mdi-download-box-outline</v-icon>
                    </v-app-bar-nav-icon>
                    <v-toolbar-title>Auto Scratch-Desktop Mirror</v-toolbar-title>
                </v-toolbar>
                <v-container class="d-flex mt-5">
                    <v-row class="mx-5">
                        <v-col>
                            <div class="text-body-1">
                                Auto Scratch-Desktop Mirror 是一个基于 GitHub Workflow 的开源镜像项目，
                                它会每周自动从 Scratch 官方网站下载最新的 Scratch 3.0 安装包并上传至 (GitHub)
                                Release 提供给用户以供下载。
                                <p class="font-weight-light mt-2 text-caption">
                                    项目开源于 <a href="https://github.com/OurWorlddev/AutoScratchDesktopMirror">GitHub</a>，本版本由 sunwuyuan 开发。
                                    <br />
                                    感谢: Scratch Team, GitHub, Vue.js, Vuetify.js, Cnpmjs, FastGit 以及所有为这个项目添砖加瓦的人们!
                                    <br />
                                </p>
                            </div>
                        </v-col>
                        <v-col>
                            <v-card elevation="2">
                                <v-card-title>下载 Scratch 3.0</v-card-title>
                                <v-card-text>
                                    未正确加载下载地址？您可以尝试 <a href="https://llk.github.io/scratch-gui/develop/">在线版本的 Scratch 3.0</a>
                                    ，或在应用商店中下载 <a
                                        href="https://apps.apple.com/cn/app/scratch-desktop/id1446785996?mt=12">Mac OS
                                        版本</a> 和 <a
                                        href="https://www.microsoft.com/zh-cn/p/scratch-3/9pfgj25jl6x3">Windows 10
                                        以上版本</a> 的 Scratch 桌面版。
                                    <br />
                                    <p class="mt-2 font-weight-bold">
                                        该版本镜像于 {{ release.date }}，Scratch 版本为 {{ release.scratch_version }}。
                                    </p>

                                </v-card-text>
                                <v-card-actions>
                                    <v-btn color="primary" v-bind:disabled="release.stat == 0"
                                        v-bind:href="`https://${download_source}${release.url.windows}`" text>
                                        <v-icon right>mdi-microsoft-windows</v-icon>
                                        Windows 下载
                                    </v-btn>
                                    <v-btn color="primary" v-bind:disabled="release.stat == 0"
                                        v-bind:href="`https://${download_source}${release.url.macos}`" text>
                                        <v-icon right>mdi-apple</v-icon>
                                        MacOS 下载
                                    </v-btn>
                            </v-card>
                            <v-card elevation="2" class="mt-7">
                                <v-card-title>设置下载源</v-card-title>
                                <v-card-text>
                                    通常情况下您<b>不需要更改下载源</b>，但如果默认下载源不可用，您可以更改为另外一个，或者自定义下载源。
                                    <v-combobox v-model="download_source"
                                        :items="['190823.xyz/https://github.com','github.com']" label=""
                                        dense></v-combobox>
                                </v-card-text>
                            </v-card>
                        </v-col>
                    </v-row>
                </v-container>
    </div>
    </div>
    </v-main>
    </v-app>
    </div>

    <script src="https://registry.npmmirror.com/vue/2.7.16/files/dist/vue.js"></script>
    <script src="https://registry.npmmirror.com/vuetify/2.7.1/files/dist/vuetify.js"></script>
    <script src="https://registry.npmmirror.com/axios/1.6.7/files/dist/axios.min.js"></script>
    <script>
        new Vue({
            el: '#app',
            vuetify: new Vuetify(),
            data: {
                release: {
                    stat: 0, // 0 => 加载中，1 => 加载成功，其他 => 加载失败:错误信息
                    url: {
                        windows: '',
                        macos: ''
                    },
                    date: '一周以内',
                    scratch_version: '未知'
                },
                download_source: '190823.xyz/https://github.com',
            },
            created: function () {
                this.release.stat = 0
                axios.get('https://api.github.com/repos/OurWorldOrg/AutoScratchDesktopMirror/releases/latest')
                    .then(res => {
                        this.release.stat = 1
                        this.release.url.windows = res.data.assets.
                            filter((element) => { return (element['name'] == "scratch-win.exe") })[0]
                            .browser_download_url
                            .replace('https://github.com', '')
                        this.release.url.macos = res.data.assets.
                            filter((element) => { return (element['name'] == "scratch-mac.dmg") })[0]
                            .browser_download_url
                            .replace('https://github.com', '')
                        this.release.date = new Date(res.data.published_at).toLocaleString()
                        this.release.scratch_version = JSON.parse(res.data.body).scratch_version
                    })
                    .catch(err => {
                        this.release.stat = err.response.status
                    })
            },
            methods: {
                toggle_custom_source: function() {
                    this.toggle_button_text = this.toggle_button_text == "自定义下载源" ? "选择下载源" : "自定义下载源"
                    if (this.toggle_button_text == "自定义下载源") { this.download_source = "github.com" }
                }
            }
        })
    </script>
</body>

</html>
